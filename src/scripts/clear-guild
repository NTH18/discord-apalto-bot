/**
 * Remove todos os comandos registrados nas guilds listadas no .env
 * Ideal antes de fazer um redeploy completo para evitar comandos antigos.
 */

import 'dotenv/config';
import { REST, Routes } from 'discord.js';

const split = (v?: string) => (v ?? '').split(',').map(s => s.trim()).filter(Boolean);

const token = process.env.DISCORD_TOKEN ?? '';
const clientId = process.env.CLIENT_ID ?? '';
const guildIds = split(process.env.GUILD_IDS);

if (!token || !clientId || !guildIds.length) {
  console.error('‚ùå Preencha DISCORD_TOKEN, CLIENT_ID e GUILD_IDS no .env');
  process.exit(1);
}

const rest = new REST({ version: '10' }).setToken(token);

(async () => {
  console.log('üßπ Limpando comandos de guilds...');
  for (const gid of guildIds) {
    try {
      await rest.put(Routes.applicationGuildCommands(clientId, gid), { body: [] });
      console.log(`‚úÖ Comandos removidos da guild ${gid}`);
    } catch (err) {
      console.error(`‚ùå Falha ao limpar guild ${gid}:`, err);
    }
  }
  console.log('‚ú® Limpeza de guilds conclu√≠da.');
})();
